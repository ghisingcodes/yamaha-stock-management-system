<app-header></app-header>

<div class="container">
  <h1>Yamaha Motorcycle Collection</h1>

  @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading bikes...</p>
    </div>
  } @else if (errorMessage()) {
    <div class="error-message">{{ errorMessage() }}</div>
  } @else {
    <div class="bike-grid" [@fadeIn]>
      @for (bike of bikes(); track bike._id) {
        <div class="bike-card" [@fadeIn]>
          <!-- Photo Gallery -->
          <div class="photo-gallery">
            @if (bike.photos?.length) {
              @for (photo of bike.photos; track photo; let i = $index) {
                <img
                  [src]="photo"
                  alt="{{bike.name}} - photo {{i+1}}"
                  [class.active]="i === 0"
                  class="gallery-photo"
                  loading="lazy"
                />
              }
            } @else {
              <div class="no-photo">No photos available</div>
            }
          </div>

          <!-- Bike Info -->
          <div class="bike-info">
            <h2>{{ bike.name }}</h2>
            <div class="meta">
              {{ bike.model || '—' }} • {{ bike.year || 'N/A' }}
            </div>
            <div class="price">${{ bike.price.toLocaleString() }}</div>
            <div class="availability" [class.in-stock]="bike.stockQuantity > 0">
              {{ bike.stockQuantity > 0 ? 'In Stock' : 'Out of Stock' }}
              ({{ bike.stockQuantity }} units)
            </div>
            <p class="description">{{ bike.description || 'No description available' }}</p>

            @if (bike.priceHistory?.length) {
              <div class="price-history">
                <h3>Price History</h3>
                <ul>
                  @for (entry of bike.priceHistory; track entry.date) {
                    <li>{{ entry.date | date:'shortDate' }}: ${{ entry.price.toLocaleString() }}</li>
                  }
                </ul>
              </div>
            }
          </div>
        </div>
      } @empty {
        <p class="no-results">No bikes found in the inventory</p>
      }
    </div>
  }
</div>
