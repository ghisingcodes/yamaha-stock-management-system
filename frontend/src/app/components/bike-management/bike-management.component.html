<app-header></app-header>

<div class="container">
  <h1>Manage Bikes</h1>

  @if (errorMessage()) {
    <div class="error-box">{{ errorMessage() }}</div>
  }

  <div class="form-section">
    <h2>{{ editingId() ? 'Edit Bike' : 'Add New Bike' }}</h2>

    <form (ngSubmit)="saveBike()" #bikeForm="ngForm">
      <div class="form-row">
        <div class="form-group">
          <label>Name *</label>
          <input [(ngModel)]="formData().name" name="name" required>
        </div>
        <div class="form-group">
          <label>Model</label>
          <input [(ngModel)]="formData().model" name="model">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Year</label>
          <input type="number" [(ngModel)]="formData().year" name="year">
        </div>
        <div class="form-group">
          <label>Price ($)</label>
          <input type="number" [(ngModel)]="formData().price" name="price">
        </div>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="formData().description" name="description" rows="3"></textarea>
      </div>

      <div class="actions">
        <button type="submit" [disabled]="isLoading() || !bikeForm.valid">
          {{ isLoading() ? 'Saving...' : (editingId() ? 'Update' : 'Create') }}
        </button>
        @if (editingId()) {
          <button type="button" class="secondary" (click)="resetForm()">Cancel</button>
        }
      </div>
    </form>
  </div>

  <div class="table-section">
    @if (isLoading()) {
      <div class="loading">Loading bikes...</div>
    } @else {
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Model</th>
            <th>Year</th>
            <th>Price</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (bike of bikes(); track bike._id) {
            <tr>
              <td>{{ bike.name }}</td>
              <td>{{ bike.model || '-' }}</td>
              <td>{{ bike.year || '-' }}</td>
              <td>{{ bike.price ? '$' + bike.price.toLocaleString() : '-' }}</td>
              <td>
                <button class="edit-btn" (click)="editBike(bike)">Edit</button>
                <button class="delete-btn" (click)="deleteBike(bike._id)">Delete</button>
              </td>
            </tr>
          } @empty {
            <tr><td colspan="5" class="empty">No bikes found</td></tr>
          }
        </tbody>
      </table>
    }
  </div>
</div>
