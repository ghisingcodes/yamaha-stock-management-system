<app-header></app-header>

<div class="container">
  <h1>Transaction Log</h1>

  @if (errorMessage()) {
    <div class="error-box">{{ errorMessage() }}</div>
  }

  <div class="form-section">
    <h2>Record New Transaction</h2>

    <form (ngSubmit)="createTransaction()">
      <div class="form-row">
        <div class="form-group">
          <label>Type</label>
          <select [(ngModel)]="newTransaction().type" name="type">
            <option value="purchase">Purchase (Add Stock)</option>
            <option value="sale">Sale (Remove Stock)</option>
          </select>
        </div>

        <div class="form-group">
          <label>Item Type</label>
          <select [(ngModel)]="newTransaction().itemType" name="itemType">
            <option value="part">Part</option>
            <option value="bike">Bike</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Item ID *</label>
          <input [(ngModel)]="newTransaction().itemId" name="itemId" required placeholder="e.g. 64a...">
        </div>

        <div class="form-group">
          <label>Quantity</label>
          <input type="number" min="1" [(ngModel)]="newTransaction().quantity" name="quantity" required>
        </div>
      </div>

      <div class="form-group">
        <label>Amount ($) - optional</label>
        <input type="number" step="0.01" [(ngModel)]="newTransaction().amount" name="amount">
      </div>

      <button type="submit" [disabled]="isLoading()">Record Transaction</button>
    </form>
  </div>

  <div class="table-section">
    <h2>Recent Transactions</h2>

    @if (isLoading()) {
      <div class="loading">Loading...</div>
    } @else {
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Item Type</th>
            <th>Item ID</th>
            <th>Quantity</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          @for (tx of transactions(); track tx._id) {
            <tr>
              <td>{{ tx.createdAt | date:'short' }}</td>
              <td [class.purchase]="tx.type === 'purchase'" [class.sale]="tx.type === 'sale'">
                {{ tx.type | titlecase }}
              </td>
              <td>{{ tx.itemType | titlecase }}</td>
              <td>{{ tx.itemId }}</td>
              <td>{{ tx.quantity }}</td>
              <td>{{ tx.amount ? '$' + tx.amount.toFixed(2) : '-' }}</td>
            </tr>
          } @empty {
            <tr><td colspan="6" class="empty">No transactions yet</td></tr>
          }
        </tbody>
      </table>
    }
  </div>
</div>
